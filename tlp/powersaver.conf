# ==============================================================================
# /etc/tlp-profiles/powersaver.conf
# ==============================================================================
# PROFILE: POWERSAVER - Maximum Battery Life
# AC:  Conservative, 80% cap
# BAT: Maximum savings, 50% cap, Turbo OFF
# Expected: 10-14 hours battery life
# ==============================================================================

# --- CPU Settings for 1260P (4P+8E cores) ---
PLATFORM_PROFILE_ON_AC=low-power
PLATFORM_PROFILE_ON_BAT=low-power

CPU_ENERGY_PERF_POLICY_ON_AC=balance_power
CPU_ENERGY_PERF_POLICY_ON_BAT=power

# Performance caps
CPU_MIN_PERF_ON_AC=0
CPU_MAX_PERF_ON_AC=80
CPU_MIN_PERF_ON_BAT=0
CPU_MAX_PERF_ON_BAT=50

# Disable Turbo Boost on battery
CPU_BOOST_ON_AC=1
CPU_BOOST_ON_BAT=0

# Disable dynamic HWP boost on battery (saves power)
CPU_HWP_DYN_BOOST_ON_AC=0
CPU_HWP_DYN_BOOST_ON_BAT=0

# --- Intel Iris Xe Graphics ---
INTEL_GPU_MIN_FREQ_ON_AC=300
INTEL_GPU_MIN_FREQ_ON_BAT=100
INTEL_GPU_MAX_FREQ_ON_AC=600
INTEL_GPU_MAX_FREQ_ON_BAT=400
INTEL_GPU_BOOST_FREQ_ON_AC=600
INTEL_GPU_BOOST_FREQ_ON_BAT=400

# --- Storage (NVMe SSD) ---
DISK_DEVICES="nvme0n1"
AHCI_RUNTIME_PM_ON_AC=auto
AHCI_RUNTIME_PM_ON_BAT=auto
AHCI_RUNTIME_PM_TIMEOUT=5

# NVMe power saving
DISK_IDLE_SECS_ON_AC=2
DISK_IDLE_SECS_ON_BAT=1

# --- PCIe Power Management ---
PCIE_ASPM_ON_AC=powersupersave
PCIE_ASPM_ON_BAT=powersupersave

# Runtime PM for all PCI devices (Thunderbolt, WiFi, etc.)
RUNTIME_PM_ON_AC=auto
RUNTIME_PM_ON_BAT=auto

# Aggressive runtime PM driver blocklist exceptions
RUNTIME_PM_DRIVER_DENYLIST=""

# Force runtime PM for specific devices that stay awake
RUNTIME_PM_ENABLE="0000:00:02.0 0000:00:0d.0 0000:00:14.0 0000:00:1f.5"

# --- Network ---
WIFI_PWR_ON_AC=on
WIFI_PWR_ON_BAT=on

# --- USB Power Saving ---
USB_AUTOSUSPEND=1
USB_EXCLUDE_BTUSB=0
USB_EXCLUDE_PHONE=0
USB_EXCLUDE_PRINTER=1
USB_EXCLUDE_WWAN=0

# Aggressive USB timeout (1 second)
USB_AUTOSUSPEND_DISABLE_ON_SHUTDOWN=0
USB_DENYLIST=""
USB_ALLOWLIST="0000:0000"

# Manual USB autosuspend settings for problematic devices
USB_AUTOSUSPEND_DISABLE_ON_SHUTDOWN=1

# --- Audio ---
SOUND_POWER_SAVE_ON_AC=1
SOUND_POWER_SAVE_ON_BAT=1
SOUND_POWER_SAVE_CONTROLLER=Y

# --- Radio Devices ---
DEVICES_TO_DISABLE_ON_STARTUP=""
DEVICES_TO_ENABLE_ON_STARTUP="wifi bluetooth"
DEVICES_TO_DISABLE_ON_BAT_NOT_IN_USE="bluetooth"

# --- Restore defaults on restart ---
RESTORE_DEVICE_STATE_ON_STARTUP=0
